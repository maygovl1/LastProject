<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.or.navi.chat.dao.ChatDAO">

	<sql id="searchFrag">
		<trim suffixOverrides="AND">
			<if test="not paging.detailCondition.empty">
				AND
				<if
					test="@org.apache.commons.lang3.StringUtils@isNotBlank(paging.detailCondition.Search)">
					INSTR(E.EMP_NAME, #{paging.detailCondition.Search}) > 0
					OR
					INSTR(D.DEPT_NAME, #{paging.detailCondition.Mark}) > 0
					OR
					INSTR(P.PS_NAME, #{paging.detailCondition.Mark}) > 0
				</if>
			</if>
		</trim>
	</sql>


	<select id="selectChatEmpList" resultType="EmpVO" parameterType="PaginationInfo">
		SELECT E.EMP_IMG, E.EMP_ID, D.DEPT_NAME, P.PS_NAME, E.EMP_NAME, E.EMP_PASS
		FROM EMP E
		JOIN POSITION P ON (E.PS_ID = P.PS_ID)
		JOIN DEPT D ON (E.DEPT_ID = D.DEPT_ID)
		WHERE EMP_PASS IS NOT NULL AND NOT E.EMP_ID = #{empId}
		<include refid="searchFrag" />
		ORDER BY DEPT_NAME DESC, EMP_NAME DESC
	</select>
</mapper>