<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.or.navi.board.form.dao.FormDAO">
	<sql id="searchFrag">
			<if test="@org.apache.commons.lang3.StringUtils@isNotBlank(simpleCondition.searchWord)">
				<choose>
					<when test="simpleCondition.searchType eq 'title'">
						INSTR(BP_TITLE, #{simpleCondition.searchWord}) > 0
					</when>
					<when test="simpleCondition.searchType eq 'name'">
						INSTR(EMP.EMP_NAME, #{simpleCondition.searchWord}) > 0
					</when>
					<otherwise>
						INSTR(BP_TITLE, #{simpleCondition.searchWord}) > 0
						OR
						INSTR(EMP.EMP_NAME, #{simpleCondition.searchWord}) > 0
					</otherwise>
				</choose>
			</if>
	</sql>


<select id="selectForm" resultType="BoardPostVO" parameterType="String">
		SELECT 
            BOARD_POST.BP_ID,
            BOARD_POST.EMP_ID,
            BOARD_POST.BP_MOD_ID,
            BOARD_POST.BRD_ID,
            BOARD_POST.BP_TITLE,
            BOARD_POST.BP_CN,
            BOARD_POST.BP_REG_DT,
            BOARD_POST.BP_DEL_DT,
            BOARD_POST.BP_OP_YN,
            BOARD_POST.BP_CNT,
            BOARD_POST.BP_MOD_DT,
            BOARD_POST.BP_SHR_YN,
            BOARD_POST.BP_NTC_ID,
            BOARD_POST.BP_QNA_AS,
            EMP.EMP_NAME
        FROM 
            BOARD_POST
        INNER JOIN 
            EMP ON (BOARD_POST.EMP_ID = EMP.EMP_ID)
        WHERE
            BOARD_POST.BRD_ID = 'BN0002' AND BOARD_POST.BP_ID = #{bpId}
	</select>
	<resultMap type="BoardPostVO" id="boardPostVOMap" autoMapping="true">
		<id property="bpId" column="BP_ID"/>
		<association property="emp" javaType="EmpVO" autoMapping="true"/>
	</resultMap>

	<select id="selectFormList"  resultMap="boardPostVOMap" parameterType="PaginationInfo">
		SELECT B.*
			FROM (
	    		SELECT ROWNUM RNUM, A.*
	    		FROM (
					SELECT
						BP_ID
						, BOARD_POST.EMP_ID
						, BRD_ID
						, BP_TITLE
						, BP_REG_DT	
						, BP_CNT
						, EMP.EMP_NAME
					FROM
						board_post
					inner join 
						emp on(board_post.emp_id = emp.emp_id)
					where 
						BRD_ID = 'BN0002'
						AND bp_del_dt IS NULL
					<include refid="searchFrag" />
					ORDER BY BP_REG_DT DESC
						) A
					) B
					<where>
						<if test="startRow gt 0 and endRow gt 0">
							<![CDATA[
								RNUM >= #{startRow} AND RNUM <= #{endRow}
							]]>
						</if>
					</where>
	</select>

	<select id="selectTotalRecord" resultType="int" parameterType="PaginationInfo">
		SELECT COUNT(*) FROM
			(SELECT
					BP_ID
					, BOARD_POST.EMP_ID
					, BRD_ID
					, BP_TITLE
					, BP_REG_DT
					, BP_CNT
					, EMP.EMP_NAME
				FROM
					board_post
				inner join 
					emp on(board_post.emp_id = emp.emp_id)
				where 
					BRD_ID = 'BN0002'
					AND bp_del_dt IS NULL
				<include refid="searchFrag" />
				ORDER BY 
					BP_REG_DT DESC
					) A
		</select>
	
	
	
	<update id="updateForm" parameterType="BoardPostVO">
		UPDATE
			BOARD_POST
		SET
			BP_TITLE = #{form.bpTitle}
			, BP_MOD_ID = #{form.bpModId}
			, BP_MOD_DT = #{form.bpModDt}
			, BP_CN = #{form.bpCn}
		WHERE
			BOARD_POST.BRD_ID = 'BN0002' AND BOARD_POST.BP_ID = #{bpId}
	</update>

</mapper>